{"instance_id": "django__django-11039", "patch_content": "diff --- a/django/core/management/commands/sqlmigrate.py\n+++ b/django/core/management/commands/sqlmigrate.py\n@@ -1,5 +1,5 @@\n # -*- coding: utf-8 -*-\n \"\"\"Show the SQL for a migration and (optionally) its reverse.\"\"\"\n \n@@ -40,7 +40,7 @@\n         connection = connections[database]\n         executor = MigrationExecutor(connection, self.stdout)\n \n-        self.output_transaction = migration.atomic\n+        # Only output an outer BEGIN/COMMIT if the migration is atomic AND the\n+        # database/schema editor supports transactional DDL (can rollback DDL).\n+        self.output_transaction = migration.atomic and connection.features.can_rollback_ddl\n \n         for operation in migration.operations:\n             with connection.schema_editor(collect_sql=True) as editor:\n                 operation.database_forwards(app_label, editor, project_state, new_state)", "success": true, "generation_time": 26.18067455291748, "attempts": 2, "token_usage": {"prompt_tokens": 1001, "completion_tokens": 714, "total_tokens": 1715}, "error_message": null, "intermediate_steps": [{"iteration": 1, "patch_content": null, "feedback": "No valid patch was extracted from the response. Please provide a patch in the correct format.", "success": false, "token_usage": {"prompt_tokens": 908, "completion_tokens": 1124, "total_tokens": 2032}}, {"iteration": 2, "patch_content": "diff --- a/django/core/management/commands/sqlmigrate.py\n+++ b/django/core/management/commands/sqlmigrate.py\n@@ -1,5 +1,5 @@\n # -*- coding: utf-8 -*-\n \"\"\"Show the SQL for a migration and (optionally) its reverse.\"\"\"\n \n@@ -40,7 +40,7 @@\n         connection = connections[database]\n         executor = MigrationExecutor(connection, self.stdout)\n \n-        self.output_transaction = migration.atomic\n+        # Only output an outer BEGIN/COMMIT if the migration is atomic AND the\n+        # database/schema editor supports transactional DDL (can rollback DDL).\n+        self.output_transaction = migration.atomic and connection.features.can_rollback_ddl\n \n         for operation in migration.operations:\n             with connection.schema_editor(collect_sql=True) as editor:\n                 operation.database_forwards(app_label, editor, project_state, new_state)", "feedback": "Patch is valid", "success": true, "token_usage": {"prompt_tokens": 1001, "completion_tokens": 714, "total_tokens": 1715}}], "confidence_score": 0.7, "metadata": {}, "timestamp": "2026-02-06T03:19:58.169933"}
